<!DOCTYPE html>
<html lang="en">
<head>
<link rel="manifest" href="manifest.json">
<meta name="theme-color" content="#000000">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>FEOServices Android M3</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <!-- Use standard Firebase SDKs -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-app.js";
        import { getAuth, signInWithCustomToken, signInAnonymously, onAuthStateChanged, signOut } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-auth.js";
        import { getFirestore } from "https://www.gstatic.com/firebasejs/11.1.0/firebase-firestore.js";

        // Environment variables
        const firebaseConfig = typeof __firebase_config !== 'undefined' ? JSON.parse(__firebase_config) : {
            apiKey: "",
            authDomain: "zinkapp-fac18.firebaseapp.com",
            projectId: "zinkapp-fac18",
            storageBucket: "zinkapp-fac18.firebasestorage.app",
            appId: "1:969322381802:web:0ee18e97f0511e615e7293"
        };
        const initialToken = typeof __initial_auth_token !== 'undefined' ? __initial_auth_token : null;
        const appId = typeof __app_id !== 'undefined' ? __app_id : 'default-app-id';

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // Exponential Backoff Fetch for Gemini API
        window.geminiFetch = async (prompt) => {
            const apiKey = "";
            let delay = 1000;
            for (let i = 0; i < 5; i++) {
                try {
                    const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-09-2025:generateContent?key=${apiKey}`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            contents: [{ parts: [{ text: `Generate a single file HTML code for: ${prompt}. Only return the code.` }] }]
                        })
                    });
                    if (response.ok) return await response.json();
                } catch (e) {}
                await new Promise(r => setTimeout(r, delay));
                delay *= 2;
            }
            throw new Error("Failed after retries");
        };

        // AUTH ACTION
        window.authAction = async (type) => {
            try {
                if (initialToken) {
                    await signInWithCustomToken(auth, initialToken);
                } else {
                    await signInAnonymously(auth);
                }
            } catch (error) {
                console.error("Auth error:", error);
                // Fallback UI login if firebase fails or is restricted
                handleAuthSuccess({ uid: "offline_op", displayName: "Operator" });
            }
        };

        window.signOutUser = async () => {
            await signOut(auth);
            location.reload();
        };

        onAuthStateChanged(auth, (user) => {
            if (user) {
                handleAuthSuccess(user);
            }
        });

        function handleAuthSuccess(user) {
            document.getElementById('auth-overlay').style.opacity = '0';
            setTimeout(() => {
                document.getElementById('auth-overlay').style.display = 'none';
                document.querySelectorAll('.auth-gate').forEach(el => el.classList.remove('locked-feature'));
                document.getElementById('user-initial').innerText = (user.displayName || "O").charAt(0).toUpperCase();
                window.currentUser = user;
            }, 500);
        }
    </script>
    <link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300;400;500;700&display=swap" rel="stylesheet">
    <style>
        :root {
            --m3-surface: #f7f9ff;
            --m3-surface-container: #eeeeee;
            --m3-primary: #005fb0;
            --m3-on-primary: #ffffff;
            --m3-secondary-container: #d8e2ff;
            --m3-on-secondary-container: #001a41;
            --m3-outline: #74777f;
            --m3-text: #000000; /* Added black text for light mode */
            --blur-val: 12px;
            --anim-speed: 0.3s;
            --anim-curve: cubic-bezier(0.2, 0, 0, 1);
        }

        .dark {
            --m3-surface: #1a1c1e;
            --m3-surface-container: #2f3033;
            --m3-primary: #a8c7ff;
            --m3-on-primary: #003062;
            --m3-secondary-container: #3f4759;
            --m3-on-secondary-container: #d8e2ff;
            --m3-outline: #8e9199;
            --m3-text: #ffffff; /* Keep white for dark mode */
        }

        body {
            background-color: var(--m3-surface);
            color: var(--m3-text);
            font-family: 'Roboto', sans-serif;
            overflow: hidden;
            transition: background-color var(--anim-speed) var(--anim-curve), color var(--anim-speed) var(--anim-curve);
        }

        .m3-card {
            background-color: var(--m3-surface-container);
            border-radius: 28px;
            padding: 16px;
            transition: all var(--anim-speed) var(--anim-curve);
        }

        .m3-list-item {
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 16px;
            cursor: pointer;
            border-radius: 16px;
            transition: background-color 0.2s;
        }
        .m3-list-item:active { background-color: rgba(255,255,255,0.08); }

        .m3-nav {
            background-color: var(--m3-surface-container);
            height: 80px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            padding-bottom: env(safe-area-inset-bottom);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 4px;
            color: var(--m3-outline);
            flex: 1;
            transition: color 0.3s;
        }

        .nav-icon-wrapper {
            width: 64px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 16px;
            transition: background-color 0.3s, transform 0.2s;
        }

        .active-tab .nav-icon-wrapper {
            background-color: var(--m3-secondary-container);
            color: var(--m3-on-secondary-container);
        }

        .view-content {
            display: none;
            height: calc(100vh - 160px);
            overflow-y: auto;
            padding: 20px;
        }
        .view-content.active {
            display: block;
            animation: m3SlideUp var(--anim-speed) var(--anim-curve);
        }

        @keyframes m3SlideUp {
            from { opacity: 0; transform: translateY(20px) scale(0.98); }
            to { opacity: 1; transform: translateY(0) scale(1); }
        }

        .m3-input {
            background-color: var(--m3-surface-container);
            border-bottom: 2px solid var(--m3-outline);
            border-radius: 8px 8px 0 0;
            padding: 16px;
            width: 100%;
            outline: none;
            color: var(--m3-text);
        }

        #auth-overlay {
            position: fixed;
            inset: 0;
            background: var(--m3-surface);
            z-index: 5000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            padding: 2rem;
            transition: opacity 0.5s ease;
        }

        canvas#art-canvas {
            background: #fff;
            touch-action: none;
            width: 100%;
            height: 400px;
            border-radius: 20px;
        }

        .locked-feature {
            filter: grayscale(1) blur(2px);
            pointer-events: none;
            opacity: 0.5;
        }

        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body class="dark">

    <!-- AUTH OVERLAY -->
    <div id="auth-overlay">
        <img src="https://feoservices.ct.ws/wp-content/uploads/2026/01/FG-HALLOWEEN-LOGO-1.png" class="w-24 h-24 mb-6 rounded-3xl shadow-2xl">
        <h2 class="text-3xl font-medium text-white mb-2">FEOServices</h2>
        <p class="text-gray-400 mb-8 text-center">Secure environment. Authentication required to access core modules.</p>
        
        <div class="w-full max-w-xs space-y-3">
            <button onclick="authAction('google')" class="w-full bg-white text-black py-4 rounded-full font-bold flex items-center justify-center gap-3 active:scale-95 transition-transform">
                <i data-lucide="mail"></i> Join System
            </button>
            <button onclick="authAction('github')" class="w-full bg-[#24292e] text-white py-4 rounded-full font-bold flex items-center justify-center gap-3 active:scale-95 transition-transform">
                <i data-lucide="github"></i> GitHub Auth
            </button>
            <div class="flex gap-2">
                <button onclick="authAction('phone')" class="flex-1 bg-gray-700 text-white py-4 rounded-full font-bold text-xs">Phone</button>
                <button onclick="authAction('email')" class="flex-1 bg-gray-700 text-white py-4 rounded-full font-bold text-xs">Email</button>
            </div>
            <p class="text-[10px] text-center text-gray-500 mt-4">By signing in, u agree to FSHB terms of service.</p>
        </div>
    </div>

    <!-- TOP BAR -->
    <header class="fixed top-0 w-full h-16 flex items-center justify-between px-6 z-50 bg-[var(--m3-surface)] border-b border-white/5">
        <div class="flex items-center gap-3">
            <img src="https://feoservices.ct.ws/wp-content/uploads/2026/01/FG-HALLOWEEN-LOGO-1.png" class="w-8 h-8 rounded-lg">
            <h1 id="view-title" class="text-lg font-medium">FEOServices</h1>
        </div>
        <div id="user-initial" onclick="signOutUser()" class="w-10 h-10 rounded-full bg-[var(--m3-primary)] flex items-center justify-center font-bold text-white cursor-pointer shadow-lg">?</div>
    </header>

    <main class="pt-20 pb-24 h-screen overflow-hidden">
        
        <!-- HOME VIEW -->
        <div id="home-view" class="view-content active">
            <div class="mb-8">
                <h2 class="text-3xl font-light">System Dashboard</h2>
                <p class="text-xs text-[var(--m3-primary)] font-bold uppercase tracking-widest mt-1">Uzi Engine Active</p>
            </div>

            <div class="grid grid-cols-1 gap-4">
                <div class="m3-card bg-gradient-to-br from-blue-600/20 to-purple-600/20 border border-white/10">
                    <h3 class="font-bold text-sm mb-4">Core Status</h3>
                    <div class="flex justify-between items-end">
                        <div>
                            <p class="text-2xl font-light" id="clock-display">00:00</p>
                            <p class="text-[10px] opacity-60">System Synchronized</p>
                        </div>
                        <div class="text-right">
                            <p class="text-xs font-bold text-green-400">ONLINE</p>
                        </div>
                    </div>
                </div>

                <div class="m3-card space-y-1">
                    <div onclick="switchView('services')" class="m3-list-item">
                        <div class="w-10 h-10 rounded-xl bg-blue-500/20 flex items-center justify-center text-blue-400"><i data-lucide="layers"></i></div>
                        <div class="flex-1"><p class="text-sm font-medium">Directory</p><p class="text-[10px] opacity-50">Access 24+ global services</p></div>
                        <i data-lucide="chevron-right" class="w-4 h-4 opacity-30"></i>
                    </div>
                    <div onclick="switchView('news')" class="m3-list-item auth-gate">
                        <div class="w-10 h-10 rounded-xl bg-orange-500/20 flex items-center justify-center text-orange-400"><i data-lucide="rss"></i></div>
                        <div class="flex-1"><p class="text-sm font-medium">FSBN News</p><p class="text-[10px] opacity-50">Internal bulletins</p></div>
                        <i data-lucide="chevron-right" class="w-4 h-4 opacity-30"></i>
                    </div>
                </div>
            </div>
        </div>

        <!-- APPS VIEW -->
        <div id="apps-view" class="view-content">
            <div class="mb-6">
                <input type="text" id="app-search" placeholder="Search applications..." oninput="filterApps()" class="m3-input">
            </div>
            <div id="app-grid" class="grid grid-cols-3 gap-4"></div>
        </div>

        <!-- SERVICES DIRECTORY -->
        <div id="services-view" class="view-content auth-gate">
            <div class="mb-6">
                <input type="text" id="service-search" placeholder="Search services..." oninput="filterServices()" class="m3-input">
            </div>
            <h3 class="text-xl font-medium mb-6">Service Directory</h3>
            <div id="service-list" class="m3-card space-y-1 p-2"></div>
        </div>

        <!-- NEWS VIEW -->
        <div id="news-view" class="view-content auth-gate">
            <h3 class="text-xl font-medium mb-4">FSBN Bureau of News</h3>
            <div class="space-y-4">
                <div class="m3-card border-l-4 border-blue-500">
                    <p class="text-[10px] opacity-50 mb-1">JAN 20, 2026</p>
                    <h4 class="font-bold text-sm">Uzi Engine 3.4 Integration</h4>
                    <p class="text-xs mt-2 opacity-70">Core system migrated to M3 Material Design. Efficiency increased by 40%.</p>
                </div>
                <div class="m3-card border-l-4 border-green-500">
                    <p class="text-[10px] opacity-50 mb-1">JAN 22, 2026</p>
                    <h4 class="font-bold text-sm">FEOServices PC App Released!</h4>
                    <p class="text-xs mt-2 opacity-70">The official desktop environment is now available for download. Experience the full power of Uzi Engine on your PC.</p>
                </div>
            </div>
        </div>

        <!-- SETTINGS VIEW -->
        <div id="settings-view" class="view-content">
            <h2 class="text-2xl font-medium mb-6">Settings</h2>
            <div class="space-y-6">
                <div class="m3-card">
                    <p class="text-[10px] font-bold text-[var(--m3-primary)] uppercase mb-4">Appearance</p>
                    <div class="flex gap-2">
                        <button onclick="setTheme('light')" class="flex-1 py-3 bg-white text-black rounded-2xl text-xs font-bold">Light</button>
                        <button onclick="setTheme('dark')" class="flex-1 py-3 bg-gray-800 text-white rounded-2xl text-xs font-bold">Dark</button>
                    </div>
                </div>

                <div class="m3-card">
                    <div class="flex justify-between items-center mb-4">
                        <p class="text-[10px] font-bold text-[var(--m3-primary)] uppercase">Uzi Engine Logic</p>
                        <span id="engine-tag" class="bg-[var(--m3-secondary-container)] px-3 py-1 rounded-full text-[10px] text-[var(--m3-on-secondary-container)] font-bold">V3.4</span>
                    </div>
                    <input type="range" id="engine-slider" min="0" max="4" value="3" oninput="updateEngine(this.value)" class="w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-[var(--m3-primary)]">
                    <p id="engine-desc" class="text-[10px] mt-4 opacity-50">Balanced performance and fluid Material You motion.</p>
                </div>

                <div class="m3-card">
                    <p class="text-[10px] opacity-30 text-center">Version 3.4.0-production<br>Â© 2026 FSHB Group</p>
                </div>
            </div>
        </div>

        <!-- SPECIAL VIEWS -->
        <div id="ide-view" class="view-content">
            <button onclick="switchView('services')" class="mb-4 text-sm text-blue-400 flex items-center gap-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back</button>
            <div class="m3-card h-full flex flex-col gap-4">
                <h3 class="font-bold">CodeLine AI IDE</h3>
                <textarea id="ai-prompt" placeholder="What should I code for you?" class="flex-1 bg-black/30 rounded-xl p-4 text-xs outline-none border border-white/10"></textarea>
                <div class="flex gap-2">
                    <select id="ai-lang" class="bg-gray-800 rounded-lg px-3 text-xs">
                        <option>Auto-detect</option>
                        <option>JavaScript</option>
                        <option>Python</option>
                        <option>HTML/CSS</option>
                    </select>
                    <button onclick="generateCode()" id="gen-btn" class="flex-1 bg-blue-600 py-3 rounded-xl font-bold text-xs">Generate & Preview</button>
                </div>
            </div>
        </div>

        <div id="artser-view" class="view-content">
            <button onclick="switchView('services')" class="mb-4 text-sm text-blue-400 flex items-center gap-2"><i data-lucide="arrow-left" class="w-4 h-4"></i> Back</button>
            <div class="m3-card">
                <canvas id="art-canvas"></canvas>
                <div class="flex justify-between mt-4">
                    <input type="color" id="brush-color" class="w-10 h-10 rounded-lg bg-transparent">
                    <button onclick="clearCanvas()" class="px-4 py-2 bg-red-500/20 text-red-400 rounded-lg text-xs font-bold">Clear</button>
                </div>
            </div>
        </div>

    </main>

    <!-- NAVIGATION BAR -->
    <nav class="fixed bottom-0 w-full m3-nav border-t border-white/5">
        <button onclick="switchView('home')" class="nav-item active-tab" data-view="home">
            <div class="nav-icon-wrapper"><i data-lucide="home"></i></div>
            <span class="text-[10px] font-medium">Home</span>
        </button>
        <button onclick="switchView('apps')" class="nav-item" data-view="apps">
            <div class="nav-icon-wrapper"><i data-lucide="grid"></i></div>
            <span class="text-[10px] font-medium">Apps</span>
        </button>
        <button onclick="switchView('services')" class="nav-item" data-view="services">
            <div class="nav-icon-wrapper"><i data-lucide="layers"></i></div>
            <span class="text-[10px] font-medium">Services</span>
        </button>
        <button onclick="switchView('settings')" class="nav-item" data-view="settings">
            <div class="nav-icon-wrapper"><i data-lucide="settings"></i></div>
            <span class="text-[10px] font-medium">System</span>
        </button>
    </nav>

    <!-- GLOBAL MODAL -->
    <div id="modal-container" class="fixed inset-0 z-[6000] bg-black/60 items-center justify-center p-6 hidden">
        <div class="m3-card w-full max-w-sm" onclick="event.stopPropagation()">
            <h3 id="modal-title" class="text-xl font-medium mb-2">Notice</h3>
            <p id="modal-body" class="text-xs text-gray-400 mb-6 leading-relaxed"></p>
            <div class="flex justify-end">
                <button onclick="closeModal()" class="text-[var(--m3-primary)] font-bold px-6 py-2">DISMISS</button>
            </div>
        </div>
    </div>

    <!-- WEB VIEW -->
    <div id="web-container" class="fixed inset-0 z-[7000] bg-black hidden flex-col">
        <div class="h-14 flex items-center px-4 justify-between bg-[var(--m3-surface)]">
            <button onclick="closeWeb()" class="p-2"><i data-lucide="x"></i></button>
            <span id="web-url" class="text-[10px] opacity-50 truncate max-w-[200px]">Browser</span>
            <div class="w-8"></div>
        </div>
        <iframe id="web-frame" class="flex-1 bg-white"></iframe>
    </div>

    <script>
        const apps = [
            { n: "CreativeAi", u: "https://creativeai.rf.gd/" },
            { n: "GPUMate", u: "https://gpumate.ct.ws/" },
            { n: "BlackPoint", u: "https://blackpoint.base44.app/" },
            { n: "Ackey Blue", m: "Coming soon..." },
            { n: "CreativeProducts", m: "Hardware series." },
            { n: "CreativePhone", m: "Mobile concept." },
            { n: "ArchLight", m: "Render engine." },
            { n: "CreativeCore Bundle", m: "Utility pack." },
            { n: "Audiyio", m: "Audio processing." },
            { n: "CreativeGaming", m: "Gaming ecosystem." }
        ];

        const services = [
            { n: "PDF Central", t: "web", v: "https://feoservices.ct.ws/pdf-viewer/" },
            { n: "Sanctuary", t: "pop", v: "This service requires a computer on hand - The phone application does not support it, please use a PC" },
            { n: "SpaceMotion", t: "pop", v: "This service requires a computer on hand - The phone application does not support it, please use a PC" },
            { n: "BinaryMate", t: "pop", v: "This service requires a computer on hand - The phone application does not support it, please use a PC" },
            { n: "Parallax", t: "pop", v: "This service requires a computer on hand - The phone application does not support it, please use a PC" },
            { n: "Universio", t: "web", v: "https://feoservices.ct.ws/universio/" },
            { n: "CreativeChat", t: "web", v: "https://feoservices.ct.ws/%e2%9a%a0%ef%b8%8f-error-%e2%9a%a0%ef%b8%8f/" },
            { n: "beloven", t: "pop", v: "This service requires a computer on hand - The phone application does not support it, please use a PC" },
            { n: "Q-Sim Info", t: "pop", v: "Q-SIM is a PC CPU assistant - Not released Yet!" },
            { n: "Uzi Engine 3.4", t: "pop", v: "This service requires a computer on hand - The phone application does not support it, please use a PC" },
            { n: "CodeLine AI IDE", t: "view", v: "ide" },
            { n: "SMC", t: "pop", v: "PC Only service." },
            { n: "SMA", t: "pop", v: "PC Only service." },
            { n: "SCM", t: "pop", v: "PC Only service." },
            { n: "NoteByte", t: "pop", v: "Ultra-fast note system with AI upgrades." },
            { n: "FSHB Brand", t: "pop", v: "FSHB owns FEOServices - All rights reserved." },
            { n: "BethLeen", t: "pop", v: "Digital archive service." },
            { n: "CER", t: "pop", v: "Code Behavior Analysis & Runtime Stress Testing." },
            { n: "Nightrunner", t: "pop", v: "Secret :3" },
            { n: "Species", t: "pop", v: "Secret :3" },
            { n: "Canvas", t: "pop", v: "Secret :3" },
            { n: "Artser", t: "view", v: "artser" },
            { n: "VolCtrl", t: "pop", v: "Volume control interface pending release." },
            { n: "FSBN News", t: "view", v: "news" }
        ];

        window.currentUser = null;

        function switchView(id) {
            if (!window.currentUser && (id === 'services' || id === 'news')) {
                openModal("Access Denied", "Please sign in to access system modules.");
                return;
            }
            document.querySelectorAll('.view-content').forEach(v => v.classList.remove('active'));
            const target = document.getElementById(id + '-view');
            if (target) target.classList.add('active');
            
            document.querySelectorAll('.nav-item').forEach(btn => {
                btn.classList.toggle('active-tab', btn.dataset.view === id);
            });
            
            const titles = { home: "FEOServices", apps: "Applications", services: "Directory", settings: "System", ide: "CodeLine IDE", artser: "Artser Draw" };
            document.getElementById('view-title').innerText = titles[id] || "FEOServices";
        }

        function updateEngine(val) {
            if (!window.currentUser) {
                document.getElementById('engine-slider').value = 3;
                openModal("Restricted", "Authentication required to modify engine parameters.");
                return;
            }
            const label = document.getElementById('engine-tag');
            const desc = document.getElementById('engine-desc');
            const root = document.documentElement;
            const names = ["V1.0", "V2.0", "V3.0", "V3.4", "CER"];
            label.innerText = names[val];

            if (val == 0) {
                root.style.setProperty('--anim-speed', '0s');
                desc.innerText = "No animations. Zero overhead.";
            } else if (val == 4) {
                root.style.setProperty('--anim-speed', '0.6s');
                root.style.setProperty('--anim-curve', 'cubic-bezier(0.34, 1.56, 0.64, 1)');
                desc.innerText = "CER Engine: High-inertia bounce. Complex state monitoring.";
            } else {
                const speed = 0.1 + (val * 0.1);
                root.style.setProperty('--anim-speed', speed + 's');
                root.style.setProperty('--anim-curve', 'cubic-bezier(0.2, 0, 0, 1)');
                desc.innerText = "Smooth Material You logic enabled.";
            }
        }

        function renderApps() {
            const grid = document.getElementById('app-grid');
            grid.innerHTML = apps.map(app => `
                <div onclick="handleAppClick('${app.u}', '${app.n}', '${app.m}')" class="m3-card flex flex-col items-center gap-2 active:scale-90 cursor-pointer">
                    <div class="w-14 h-14 rounded-2xl bg-white/5 flex items-center justify-center text-[var(--m3-primary)]">
                        <i data-lucide="package"></i>
                    </div>
                    <span class="text-[10px] font-medium text-center truncate w-full">${app.n}</span>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function handleAppClick(u, n, m) {
            if (u !== 'undefined' && u !== 'undefined' && u !== "undefined") openWeb(u);
            else openModal(n, m || "No further info.");
        }

        function renderServices(data = services) {
            const list = document.getElementById('service-list');
            list.innerHTML = data.map(s => `
                <div onclick="handleService('${s.t}', '${s.v}', '${s.n}')" class="m3-list-item">
                    <div class="w-8 h-8 rounded-full bg-white/5 flex items-center justify-center"><i data-lucide="cog" class="w-4 h-4 opacity-50"></i></div>
                    <span class="text-xs font-medium flex-1">${s.n}</span>
                    <i data-lucide="chevron-right" class="w-3 h-3 opacity-20"></i>
                </div>
            `).join('');
            lucide.createIcons();
        }

        function filterServices() {
            const query = document.getElementById('service-search').value.toLowerCase();
            const filtered = services.filter(s => s.n.toLowerCase().includes(query));
            renderServices(filtered);
        }

        function handleService(t, v, n) {
            if (t === 'web') openWeb(v);
            else if (t === 'pop') openModal(n, v);
            else if (t === 'view') switchView(v);
        }

        function openModal(t, b) {
            document.getElementById('modal-title').innerText = t;
            document.getElementById('modal-body').innerText = b;
            document.getElementById('modal-container').style.display = 'flex';
        }
        function closeModal() { document.getElementById('modal-container').style.display = 'none'; }

        function openWeb(url) {
            document.getElementById('web-url').innerText = url;
            document.getElementById('web-frame').src = url;
            document.getElementById('web-container').style.display = 'flex';
        }
        function closeWeb() {
            document.getElementById('web-container').style.display = 'none';
            document.getElementById('web-frame').src = "";
        }

        // Artser Logic
        const canvas = document.getElementById('art-canvas');
        const ctx = canvas.getContext('2d');
        let drawing = false;

        function initCanvas() {
            canvas.width = canvas.offsetWidth;
            canvas.height = canvas.offsetHeight;
            ctx.lineWidth = 3;
            ctx.lineCap = 'round';
        }

        canvas.addEventListener('touchstart', (e) => { drawing = true; ctx.beginPath(); });
        canvas.addEventListener('touchend', () => drawing = false);
        canvas.addEventListener('touchmove', (e) => {
            if (!drawing) return;
            const touch = e.touches[0];
            const rect = canvas.getBoundingClientRect();
            ctx.lineTo(touch.clientX - rect.left, touch.clientY - rect.top);
            ctx.strokeStyle = document.getElementById('brush-color').value;
            ctx.stroke();
        });

        function clearCanvas() { ctx.clearRect(0,0,canvas.width,canvas.height); }

        // AI IDE Logic
        async function generateCode() {
            const prompt = document.getElementById('ai-prompt').value;
            const btn = document.getElementById('gen-btn');
            if (!prompt) return;
            
            btn.innerText = "Processing...";
            btn.disabled = true;

            try {
                const data = await window.geminiFetch(prompt);
                const code = data.candidates[0].content.parts[0].text.replace(/```html|```/g, '');
                const blob = new Blob([code], { type: 'text/html' });
                openWeb(URL.createObjectURL(blob));
            } catch (e) {
                openModal("Error", "AI module failed to respond.");
            } finally {
                btn.innerText = "Generate & Preview";
                btn.disabled = false;
            }
        }

        function filterApps() {
            const query = document.getElementById('app-search').value.toLowerCase();
            const filtered = apps.filter(a => a.n.toLowerCase().includes(query));
            const grid = document.getElementById('app-grid');
            grid.innerHTML = filtered.map(app => `
                <div onclick="handleAppClick('${app.u}', '${app.n}', '${app.m}')" class="m3-card flex flex-col items-center gap-2 active:scale-90 cursor-pointer">
                    <div class="w-14 h-14 rounded-2xl bg-white/5 flex items-center justify-center text-[var(--m3-primary)]">
                        <i data-lucide="package"></i>
                    </div>
                    <span class="text-[10px] font-medium text-center truncate w-full">${app.n}</span>
                </div>
            `).join('');
            lucide.createIcons();
        }

        setInterval(() => {
            const now = new Date();
            document.getElementById('clock-display').innerText = now.getHours().toString().padStart(2, '0') + ":" + now.getMinutes().toString().padStart(2, '0');
        }, 1000);

        window.onload = () => {
            renderApps();
            renderServices();
            initCanvas();
            document.querySelectorAll('.auth-gate').forEach(el => el.classList.add('locked-feature'));
            lucide.createIcons();
        };

        function setTheme(t) {
            document.body.classList.toggle('dark', t === 'dark');
            const root = document.documentElement;
            if(t === 'light') {
                root.style.setProperty('--m3-surface', '#f7f9ff');
                root.style.setProperty('--m3-surface-container', '#eeeeee');
                root.style.setProperty('--m3-text', '#000000');
            } else {
                root.style.setProperty('--m3-surface', '#1a1c1e');
                root.style.setProperty('--m3-surface-container', '#2f3033');
                root.style.setProperty('--m3-text', '#ffffff');
            }
        }
    </script>
</body>
</html>